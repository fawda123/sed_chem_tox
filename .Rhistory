evvr <- dat %>%
select(-lon, -lat)
# Chunk 3: pairplot
ggpairs(evvr[, -1])
dat_frm <- evvr %>%
data.frame %>%
filter(amph_surv > 30) %>%
# filter(tn < 0.4 & toc < 4 & amph_surv > 30)%>%
mutate(
tn = log10(tn),
toc = log10(toc),
fine = ifelse(is.na(fine), mean(fine, na.rm = TRUE), fine),
embr_surv = ifelse(is.na(embr_surv), mean(embr_surv, na.rm = TRUE), embr_surv)
) %>%
column_to_rownames('station') %>%
decostand(method = 'standardize')
ggpairs(dat_frm)
# Chunk 4
# cluster with euclidean dissim, ward grouping
dend <- dat_frm %>%
vegdist(method = 'euclidean') %>%
hclust(method = 'average')
ngrps <- 4
grps <- cutree(dend, k = ngrps)
p1 <- dend %>%
as.dendrogram %>%
set("branches_k_color", k = ngrps) %>%
set("labels_colors", k = ngrps) %>%
set("labels_cex", 0.4)
# circlize_dendrogram(p1)
plot(p1)
# Chunk 5
ppp <- PCA(dat_frm, scale.unit = F, graph = F)
dimdesc(ppp, axes = c(1:3))
mythm <- theme_bw(base_family = 'serif') +
theme(
legend.position = 'none',
strip.background = element_blank(),
plot.margin = margin(0, 2, 0, 2, "pt")
)
p1 <- ggord(ppp, grp_in = as.character(grps), vec_ext = 3, facet = T, nfac = 4, alpha = 0.8, size = 2, txt = 4, arrow = 0.2) +
mythm
p1
p2 <- ggord(ppp, grp_in = as.character(grps), axes = c("2", "3"), vec_ext = 3, facet = T, nfac = 4, alpha = 0.8, size = 2, txt = 4, arrow = 0.2) +
mythm
p2
dat_frm
toplo <- dat_frm %>%
rownames_to_column('station') %>%
left_join(locs, by = 'station)
toplo <- dat_frm %>%
rownames_to_column('station') %>%
left_join(locs, by = 'station')
head(toplo)
dim(toplo)
head(dat_frm)
toplo <- dat_frm %>%
rownames_to_column('station') %>%
left_join(locs, by = 'station') %>%
mutate(Group = grps)
toplo <- dat_frm %>%
rownames_to_column('station') %>%
left_join(locs, by = 'station') %>%
mutate(Group = grps)
bbx <- make_bbox(lon = toplo$lon, lat = toplo$lat, f = 0.1)
bsmap <- get_stamenmap(bbx, maptype = "toner-lite", zoom = 8)
ggmap(bsmap) +
geom_point(data = toplo, aes(x = lon, y = lat, colour = Groups),
alpha = 0.6, size = 2) +
# scale_colour_manual(values = cols) +
theme_bw() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank()
)
toplo <- dat_frm %>%
rownames_to_column('station') %>%
left_join(locs, by = 'station') %>%
mutate(Groups = grps)
bbx <- make_bbox(lon = toplo$lon, lat = toplo$lat, f = 0.1)
bsmap <- get_stamenmap(bbx, maptype = "toner-lite", zoom = 8)
ggmap(bsmap) +
geom_point(data = toplo, aes(x = lon, y = lat, colour = Groups),
alpha = 0.6, size = 2) +
# scale_colour_manual(values = cols) +
theme_bw() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank()
)
toplo <- dat_frm %>%
rownames_to_column('station') %>%
left_join(locs, by = 'station') %>%
mutate(Groups = grps)
bbx <- make_bbox(lon = toplo$lon, lat = toplo$lat, f = 0.1)
bsmap <- get_stamenmap(bbx, maptype = "toner-lite", zoom = 8)
ggmap(bsmap) +
geom_point(data = toplo, aes(x = lon, y = lat, colour = factor(Groups)),
alpha = 0.6, size = 2) +
# scale_colour_manual(values = cols) +
theme_bw() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank()
)
bsmap <- get_stamenmap(bbx, maptype = "toner-lite", zoom = 7)
bsmap <- get_stamenmap(bbx, maptype = "toner-lite", zoom = 9)
toplo <- dat_frm %>%
rownames_to_column('station') %>%
left_join(locs, by = 'station') %>%
mutate(Groups = grps)
bbx <- make_bbox(lon = toplo$lon, lat = toplo$lat, f = 0.1)
bsmap <- get_stamenmap(bbx, maptype = "toner-lite", zoom = 9)
ggmap(bsmap) +
geom_point(data = toplo, aes(x = lon, y = lat, colour = factor(Groups)),
alpha = 0.6, size = 2) +
# scale_colour_manual(values = cols) +
theme_bw() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank()
)
library(mapview)
mapview(toplo)
mapview(toplo, xcol = 'lon', ycol = 'lat')
mapview
?mapview
names(toplo)
mapview(toplo, xcol = toplo$lon, ycol = toplo$lat)
mapview(toplo, xcol = 'lon', ycol = 'lat')
toplo$lon
toplo
toplo <- dat_frm %>%
rownames_to_column('station') %>%
left_join(locs, by = 'station') %>%
mutate(Groups = grps) %>%
filter(!is.na(lon))
mapview(toplo, xcol = 'lon', ycol = 'lat')
mapview(toplo, xcol = 'lon', ycol = 'lat', zcol = 'Groups')
mapviewGetOption("basemaps")
mapview(toplo, xcol = 'lon', ycol = 'lat', zcol = 'Groups', map.types = mapviewGetOption("basemaps"))
library(sf)
prstr <- "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0"
toplo <- dat_frm %>%
rownames_to_column('station') %>%
left_join(locs, by = 'station') %>%
mutate(Groups = grps) %>%
filter(!is.na(lon)) %>%
st_as_sf(coords = c('lon', 'lat'), crs = prstr)
mapview(toplo, zcol = 'Groups')
mapviewGetOption("vector.palette")
mapviewGetOption("vector.palette")(c(1, 3))
mapviewGetOption("vector.palette")(c(2)
))
mapviewGetOption("vector.palette")(c(2))
mapviewGetOption("vector.palette")(c(4))
# cluster with euclidean dissim, ward grouping
dend <- dat_frm %>%
vegdist(method = 'euclidean') %>%
hclust(method = 'average')
ngrps <- 4
cols <- mapviewGetOption("vector.palette")(ngrps)
grps <- cutree(dend, k = ngrps)
p1 <- dend %>%
as.dendrogram %>%
set("branches_k_color", k = ngrps) %>%
set("labels_colors", cols) %>%
set("labels_cex", 0.4)
# circlize_dendrogram(p1)
plot(p1)
# cluster with euclidean dissim, ward grouping
dend <- dat_frm %>%
vegdist(method = 'euclidean') %>%
hclust(method = 'average')
ngrps <- 4
cols <- mapviewGetOption("vector.palette")(ngrps)
grps <- cutree(dend, k = ngrps)
p1 <- dend %>%
as.dendrogram %>%
set("branches_k_color", k = ngrps) %>%
set("labels_colors", k = ngrps) %>%
set("labels_cex", 0.4)
# circlize_dendrogram(p1)
plot(p1)
?color_branches
# cluster with euclidean dissim, ward grouping
dend <- dat_frm %>%
vegdist(method = 'euclidean') %>%
hclust(method = 'average')
ngrps <- 4
cols <- mapviewGetOption("vector.palette")(ngrps)
grps <- cutree(dend, k = ngrps)
p1 <- dend %>%
as.dendrogram %>%
set("branches_k_color", k = ngrps) %>%
set("labels_colors", k = ngrps) %>%
set("labels_cex", 0.4) %>%
color_branches(col = cols)
# circlize_dendrogram(p1)
plot(p1)
dend %>%
as.dendrogram %>%
set("branches_k_color", k = ngrps) %>%
set("labels_colors", k = ngrps) %>%
set("labels_cex", 0.4) %>%
color_branches(col = mapviewGetOption("vector.palette"))
p1 <- dend %>%
as.dendrogram %>%
set("branches_k_color", k = ngrps) %>%
set("labels_colors", k = ngrps) %>%
set("labels_cex", 0.4) %>%
color_branches(col = mapviewGetOption("vector.palette"))
# circlize_dendrogram(p1)
plot(p1)
# cluster with euclidean dissim, ward grouping
dend <- dat_frm %>%
vegdist(method = 'euclidean') %>%
hclust(method = 'average')
ngrps <- 4
cols <- mapviewGetOption("vector.palette")(ngrps)
grps <- cutree(dend, k = ngrps)
p1 <- dend %>%
as.dendrogram %>%
set("branches_k_color", k = ngrps, col = cols) %>%
set("labels_colors", k = ngrps) %>%
set("labels_cex", 0.4)
# circlize_dendrogram(p1)
plot(p1)
# cluster with euclidean dissim, ward grouping
dend <- dat_frm %>%
vegdist(method = 'euclidean') %>%
hclust(method = 'average')
ngrps <- 4
cols <- mapviewGetOption("vector.palette")(ngrps)
grps <- cutree(dend, k = ngrps)
p1 <- dend %>%
as.dendrogram %>%
set("branches_k_color", k = ngrps, cols = cols) %>%
set("labels_colors", k = ngrps) %>%
set("labels_cex", 0.4)
# circlize_dendrogram(p1)
plot(p1)
?branches_k_color
class(p1)
?branches_color
col_fun <- mapviewGetOption("vector.palette")
sapply(grps, col_fun)
grps
as.numeric(grps)
as.numeric(grps) %>% sapply(col_fun)
col_fun <- mapviewGetOption("vector.palette")[ngrps]
col_fun <- mapviewGetOption("vector.palette")(ngrps)
col_fun
ngrps <- 4
col <- mapviewGetOption("vector.palette")(ngrps)
names(col) <- c('1','2', '3', '4')
col
enframe(col)
col <- mapviewGetOption("vector.palette")(ngrps)
names(col) <- c('1','2', '3', '4')
col <- enframe(col) %>%
rename(Groups = name)
col <- data.frame(Groups = as.character(grps)) %>%
left_join(col, by =- 'Groups')
col <- mapviewGetOption("vector.palette")(ngrps)
names(col) <- c('1','2', '3', '4')
col <- enframe(col) %>%
rename(Groups = name)
col <- data.frame(Groups = as.character(grps)) %>%
left_join(col, by = 'Groups')
col <- mapviewGetOption("vector.palette")(ngrps)
names(col) <- c('1','2', '3', '4')
col <- enframe(col) %>%
rename(Groups = name)
col <- data.frame(Groups = as.character(grps), stringsAsFactors = F) %>%
left_join(col, by = 'Groups')
col
p1 <- dend %>%
as.dendrogram %>%
set("labels_cex", 0.4) %>%
branches_color(col = col)
col
data.frame(Groups = as.character(grps), stringsAsFactors = F) %>%
left_join(col, by = 'Groups') %>%
.$value
col <- mapviewGetOption("vector.palette")(ngrps)
names(col) <- c('1','2', '3', '4')
col <- enframe(col) %>%
rename(Groups = name)
col <- data.frame(Groups = as.character(grps), stringsAsFactors = F) %>%
left_join(col, by = 'Groups') %>%
.$value
dend %>%
as.dendrogram %>%
set("labels_cex", 0.4) %>%
branches_color(col = col)
# circlize_dendrogram(p1)
plot(p1)
warnings()
col
class(col)
?color_branches
p1 <- dend %>%
as.dendrogram %>%
set("labels_cex", 0.4) %>%
color_branches(k = ngrps, col = col)
col <- mapviewGetOption("vector.palette")(ngrps)
dend %>%
as.dendrogram %>%
set("labels_cex", 0.4) %>%
color_branches(k = ngrps, col = col)
p1 <- dend %>%
as.dendrogram %>%
set("labels_cex", 0.4) %>%
color_branches(k = ngrps, col = col)
# circlize_dendrogram(p1)
plot(p1)
?ggord
grps
table(grps)
?ggpairs
toplo <- dat_frm %>%
mutate(Groups = grps)
ggpairs(dat_frm, mapping = ggplot2::aes(color = Groups))
ggpairs(toplo, mapping = ggplot2::aes(color = Groups))
toplo <- dat_frm %>%
mutate(Groups = as.character(grps))
ggpairs(toplo, mapping = ggplot2::aes(color = Groups))
p <- ggpairs(toplo, mapping = ggplot2::aes(color = Groups))
p$nrow
scales <- scale_colour_manual(values = col) %+% scale_fill_manual(values = col)
for (row in seq_len(p$nrow))
for (col in seq_len(p$ncol))
p[row, col] <- p[row, col] + scales
p
col
col <- mapviewGetOption("vector.palette")(ngrps)
scales <- scale_colour_manual(values = col) %+% scale_fill_manual(values = col)
p <- ggpairs(toplo, mapping = ggplot2::aes(color = Groups))
for (row in seq_len(p$nrow))
for (col in seq_len(p$ncol))
p[row, col] <- p[row, col] + scales
p
?scale_colour_manual
col
cols <- mapviewGetOption("vector.palette")(ngrps)
toplo <- dat_frm %>%
mutate(Groups = as.character(grps))
scales <- scale_colour_manual(values = cols) %+% scale_fill_manual(values = cols)
p <- ggpairs(toplo, mapping = ggplot2::aes(color = Groups))
for (row in seq_len(p$nrow))
for (col in seq_len(p$ncol))
p[row, col] <- p[row, col] + scales
p
cols
p[1, 3]
p[1, 4]
p[1, 1]
p[1, 1] + scale_colour_manual(values = c('red', 'green', 'blue', 'purple'))
scales <- scale_colour_brewer(type = 'qual') %+% scale_fill_brewer(type = 'qual')
p <- ggpairs(toplo, mapping = ggplot2::aes(color = Groups))
for (row in seq_len(p$nrow))
for (col in seq_len(p$ncol))
p[row, col] <- p[row, col] + scales
p[1, 1]
p <- ggpairs(toplo, color = 'Groups')
p <- ggpairs(toplo, colour = 'Groups')
scales <- scale_colour_manual(values = cols) %+% scale_fill_manual(values = cols)
p[1, 1]
p[1, 1] + scale_colour_manual('red')
class(p[1, 1])
p <- ggpairs(toplo, mapping = ggplot2::aes(color = Groups))
p[1,1]
p[1,1] + scales
p[1,1] %+% scales
p <- ggpairs(toplo, mapping = ggplot2::aes(fill = Groups, colour = Groups))
p[1,1] %+% scales
p[2,1] %+% scales
p[2,1] %+% scale_colour_manual(values = c())
p[2,1] %+% scale_colour_manual(values = c('red', 'green', 'blue', 'orange'))
cols
p <- ggpairs(toplo, mapping = ggplot2::aes(fill = Groups, colour = Groups))
for (row in seq_len(p$nrow))
for (col in seq_len(p$ncol))
p[row, col] <- p[row, col] + scale_colour_manual(values = cols) %+% scale_fill_manual(values = cols)
p
cols
p <- ggpairs(toplo, mapping = ggplot2::aes(fill = Groups, colour = Groups))
for (row in seq_len(p$nrow))
for (col in seq_len(p$ncol))
p[row, col] <- p[row, col] + scale_colour_manual(values = c("#440154FF", "#31688EFF", "#35B779FF", "#FDE725FF"))
p
toplo <- dat_frm %>%
mutate(Groups = as.character(grps))
scales <- scale_colour_manual(values = c("#440154FF", "#31688EFF", "#35B779FF", "#FDE725FF")) %+% scale_fill_manual(values = c("#440154FF", "#31688EFF", "#35B779FF", "#FDE725FF"))
p <- ggpairs(toplo, mapping = ggplot2::aes(fill = Groups, colour = Groups))
for (row in seq_len(p$nrow))
for (col in seq_len(p$ncol))
p[row, col] <- p[row, col] + scales
p
scales
scales <- scale_colour_manual(values = c("#440154FF", "#31688EFF", "#35B779FF", "#FDE725FF")) %+% scale_fill_manual(values = c("#440154FF", "#31688EFF", "#35B779FF", "#FDE725FF"))
scales
scls <- scale_colour_manual(values = c("#440154FF", "#31688EFF", "#35B779FF", "#FDE725FF")) %+% scale_fill_manual(values = c("#440154FF", "#31688EFF", "#35B779FF", "#FDE725FF"))
scls
scls <- scale_colour_manual(values = c("#440154FF", "#31688EFF", "#35B779FF", "#FDE725FF")) + scale_fill_manual(values = c("#440154FF", "#31688EFF", "#35B779FF", "#FDE725FF"))
toplo <- dat_frm %>%
mutate(Groups = as.character(grps))
p <- ggpairs(toplo, mapping = ggplot2::aes(fill = Groups, colour = Groups))
for (row in seq_len(p$nrow))
for (col in seq_len(p$ncol))
p[row, col] <- p[row, col] + scale_colour_manual(values = cols) + scale_fill_manual(values = cols)
p
toplo <- dat_frm %>%
mutate(Groups = as.character(grps))
p <- ggpairs(toplo, mapping = ggplot2::aes(colour = Groups))
for (row in seq_len(p$nrow))
for (col in seq_len(p$ncol))
p[row, col] <- p[row, col] + scale_colour_manual(values = cols)
p
ngrps <- 5
grps <- cutree(dend, k = ngrps)
table(grps)
grps[grps == 3] <- 1
table(grps)
ngrps <- 5
grps <- cutree(dend, k = ngrps)
grps
table(grps)
cols
# cluster with euclidean dissim, ward grouping
dend <- dat_frm %>%
vegdist(method = 'euclidean') %>%
hclust(method = 'average')
ngrps <- 5
grps <- cutree(dend, k = ngrps)
grps[grps == 3] <- 5
cols <- mapviewGetOption("vector.palette")(ngrps)
cols[3] <- cols[5]
p1 <- dend %>%
as.dendrogram %>%
set("labels_cex", 0.4) %>%
color_branches(k = ngrps, col = cols) %>%
color_labels(k = ngrps, col = cols)
# circlize_dendrogram(p1)
plot(p1)
# cluster with euclidean dissim, ward grouping
dend <- dat_frm %>%
vegdist(method = 'euclidean') %>%
hclust(method = 'average')
ngrps <- 5
grps <- cutree(dend, k = ngrps)
grps[grps == 3] <- 5
cols <- mapviewGetOption("vector.palette")(ngrps)
cols[2] <- cols[1]
p1 <- dend %>%
as.dendrogram %>%
set("labels_cex", 0.4) %>%
color_branches(k = ngrps, col = cols) %>%
color_labels(k = ngrps, col = cols)
# circlize_dendrogram(p1)
plot(p1)
# cluster with euclidean dissim, ward grouping
dend <- dat_frm %>%
vegdist(method = 'euclidean') %>%
hclust(method = 'average')
ngrps <- 5
grps <- cutree(dend, k = ngrps)
grps[grps == 3] <- 5
cols <- mapviewGetOption("vector.palette")(ngrps)
cols[4] <- cols[5]
p1 <- dend %>%
as.dendrogram %>%
set("labels_cex", 0.4) %>%
color_branches(k = ngrps, col = cols) %>%
color_labels(k = ngrps, col = cols)
# circlize_dendrogram(p1)
plot(p1)
cols
grps
cols
# cluster with euclidean dissim, ward grouping
dend <- dat_frm %>%
vegdist(method = 'euclidean') %>%
hclust(method = 'average')
ngrps <- 5
grps <- cutree(dend, k = ngrps)
grps[grps == 3] <- 5
cols <- mapviewGetOption("vector.palette")(ngrps)
cols[4] <- cols[5]
cols <- cols[c(1, 3, 2, 4, 5)]
p1 <- dend %>%
as.dendrogram %>%
set("labels_cex", 0.4) %>%
color_branches(k = ngrps, col = cols) %>%
color_labels(k = ngrps, col = cols)
# circlize_dendrogram(p1)
plot(p1)
table(grps)
ppp <- PCA(dat_frm, scale.unit = F, graph = F)
dimdesc(ppp, axes = c(1:3))
mythm <- theme_bw(base_family = 'serif') +
theme(
legend.position = 'none',
strip.background = element_blank(),
plot.margin = margin(0, 2, 0, 2, "pt")
)
p1 <- ggord(ppp, grp_in = as.character(grps), vec_ext = 3, alpha = 0.8, size = 2, txt = 4, arrow = 0.2, cols = cols) +
mythm
p1
dim(locs)
?decostand
